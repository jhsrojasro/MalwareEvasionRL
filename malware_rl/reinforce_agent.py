import gym
import malware_rl
import sys
import pickle
sys.path.append("..")
from RL.REINFORCE.reinforce import ReinforceMalwareAgent
from RL.utils.graphs import plot_metrics

epochs = 10
test_episodes = 10

environments = [ "malconv-train-v0", "ember-train-v0"]

env = gym.make(environments[1])

agent = ReinforceMalwareAgent(env, nn_hidden_units=64)

metrics = agent.train(epochs, batch_size=10, save_path=f"models/reinforce_ember_{epochs}_epochs.pt")

n_evasions, evasions_data = agent.test(test_episodes)
pickle.dump( evasions_data, open( f"data/evaded/ember/reinforce_ember_{epochs}_epochs.p", "wb" ) )
pickle.dump( agent, open( f"models/reinforce_ember_{epochs}_epochs.p", "wb" ))
# print(metrics)
# print(evasions_data)
print("Metrics: ", metrics)
print("Number of evasions: ", n_evasions)
print("Percentage of evasions: ", n_evasions/test_episodes)